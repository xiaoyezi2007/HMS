# **系统需求分析**

- **目标用户**：患者、医生、护士、药师、管理员。
- **核心业务**：挂号就诊、病历管理、处方与药房流转、住院管理与护理任务、支付结算、后台维护。
- **关键需求**：
  1. 患者：在线挂号、查询病历/费用、查看住院及护理明细。
  2. 医生：查看挂号、编写病历、开处方/检查/住院、创建护理计划。
  3. 护士：按排班查看并执行护理任务、提交反馈、办理出院。
  4. 药房：药品库存管理、处方调配与发药记录。
  5. 管理员：科室/人员/病房/药品维护、用户与权限管理、监控运营数据。

---

## 数据流图

- **外部实体**：患者、医生、护士、药房、管理员、支付平台。
- **主要处理过程**：
  1. `P1 挂号与预约`：接收患者信息→生成挂号→输出挂号确认。
  2. `P2 医生接诊`：读取挂号/病历→输出病历、处方、住院申请。
  3. `P3 护理与住院管理`：根据住院记录生成护理任务→护士执行→更新护理结果。
  4. `P4 支付结算`：汇总挂号/处方/检查/住院费用→调用支付平台→保存支付记录。
  5. `P5 后台运维`：管理员维护科室、人员、药品、病房等基础数据。
- **数据存储**：
  - `D1 Patient/Account`
  - `D2 Registration & Medical Record`
  - `D3 Prescription & Medicine`
  - `D4 Hospitalization & NurseTask`
  - `D5 Payment`
- **数据流示例**：
  - 患者→(P1)→挂号请求→D2→挂号确认。
  - 医生→(P2)→病历/处方→D2/D3。
  - 住院记录→(P3)→护理任务→护士执行反馈→D4。
  - D2/D3/D4→(P4)→账单→支付平台→支付结果→D5。
  - 管理员→(P5)→基础数据→D1/D3/D4。


### 数据元素表

| 数据项 | 描述 | 来源/去向 |
| --- | --- | --- |
| `patient_id` | 患者编号，唯一标识 | D1，P1/P4 |
| `name` / `gender` / `birth_date` / `phone` | 患者基本信息 | D1，所有业务查询 |
| `reg_id` | 挂号编号 | P1→D2，P2/P4 使用 |
| `reg_type` / `visit_date` / `status` / `fee` | 挂号属性 | D2，P1/P2/P4 |
| `record_id` | 病历编号 | P2→D2，P3/P4 使用 |
| `complaint` / `diagnosis` / `suggestion` | 病历内容 | D2 |
| `pres_id` | 处方编号 | P2→D3，P4 使用 |
| `medicine_id` / `name` / `price` / `stock` | 药品信息 | D3，P2/P4 |
| `hosp_id` | 住院记录编号 | P2→D4，P3/P4 使用 |
| `ward_id` / `type` / `bed_count` | 病房信息 | D4 |
| `task_id` / `type` / `time` / `detail` | 护理任务 | P3→D4 |
| `payment_id` | 缴费编号 | P4→D5 |
| `amount` / `payment_type` / `status` | 费用信息 | D5 |


## 数据库概念模式（E-R 模型）

- **实体及其主要关系**：

- **UserAccount ↔ (Doctor / Nurse / Patient)**：一对一，通过电话字段关联，统一认证后派生角色档案。  
- **Department ↔ (Doctor / Nurse / Ward)**：一对多，科室拥有多名医生、护士以及病房。  
- **Ward ↔ NurseSchedule**：一对多；每个病房有多条排班记录，排班关联具体护士。  
- **Patient ↔ Registration**：一对多；患者有多次挂号。  
- **Registration ↔ MedicalRecord**：一对一；每次挂号生成唯一病历。  
- **MedicalRecord ↔ (Prescription / Examination / Hospitalization)**：一对多；病历衍生处方、检查、住院记录。  
- **Prescription ↔ PrescriptionDetail ↔ Medicine**：处方与明细一对多，明细指向具体药品。  
- **Hospitalization ↔ NurseTask**：一对多；住院记录下发多条护理任务。  
- **Doctor ↔ (Registration / Hospitalization / NurseTask)**：医生负责挂号、住院管理与护理任务创建，均通过外键指向。  
- **Patient ↔ Payment**：一对多；患者所有费用（挂号、处方、检查、住院）统一存于支付表，并外键指向相应业务单据。


## 逻辑模式与规范化

- 所有表均符合 **BCNF**：
  

**useraccount**  
- Attributes: `phone`, `username`, `password_hash`, `role`, `register_time`, `status`  
- PK: `phone`  
- FK: —  

**department**  
- Attributes: `dept_id`, `dept_name`, `telephone`  
- PK: `dept_id`  
- FK: —  

**doctor**  

- Attributes: `doctor_id`, `name`, `gender`, `title`, `phone`, `dept_id`  
- PK: `doctor_id`  
- FK: `phone` → useraccount.phone；`dept_id` → department.dept_id  

**nurse**  
- Attributes: `nurse_id`, `name`, `gender`,  `phone`, `is_head_nurse`  
- PK: `nurse_id`  
- FK: `phone` → useraccount.phone

**patient**  
- Attributes: `patient_id`, `name`, `gender`, `birth_date`, `id_number`, `address`, `phone`  
- PK: `patient_id`  
- FK: `phone` → useraccount.phone  

**ward**  
- Attributes: `ward_id`, `dept_id`, `type`, `bed_count`  
- PK: `ward_id`  
- FK: `dept_id` → department.dept_id  

**nurseschedule**  
- Attributes: `schedule_id`, `nurse_id`, `ward_id`, `start_time`, `end_time`  
- PK: `schedule_id`  
- FK: `nurse_id` → nurse.nurse_id；`ward_id` → ward.ward_id  

**registration**  

- Attributes: `reg_id`, `patient_id`, `doctor_id`, `reg_type`, `reg_date`, `visit_date`, `status`, `fee`  
- PK: `reg_id`  
- FK: `patient_id` → patient.patient_id；`doctor_id` → doctor.doctor_id  

**medicalrecord**  
- Attributes: `record_id`, `reg_id`, `create_time`, `complaint`, `diagnosis`, `suggestion`  
- PK: `record_id`  
- FK: `reg_id` → registration.reg_id (UNIQUE)  

**examination**  

- Attributes: `exam_id`, `record_id`, `type`, `result`, `date`, `fee`  
- PK: `exam_id`  
- FK: `record_id` → medicalrecord.record_id  

**medicine**  
- Attributes: `medicine_id`, `name`, `price`, `stock`, `unit`, `expire_date`
- PK: `medicine_id`  
- FK: —  

**prescription**  
- Attributes: `pres_id`, `record_id`, `create_time`, `total_amount`
- PK: `pres_id`  
- FK: `record_id` → medicalrecord.record_id

**prescriptiondetail**  
- Attributes: `detail_id`, `pres_id`, `medicine_id`, `quantity`, `usage`
- PK: `detail_id`  
- FK: `pres_id` → prescription.pres_id；`medicine_id` → medicine.medicine_id  

**hospitalization**  
- Attributes: `hosp_id`, `record_id`, `ward_id`, `hosp_doctor_id`, `status`, `in_date`, `out_date`, `deposit_amount`  
- PK: `hosp_id`  
- FK: `record_id` → medicalrecord.record_id；`ward_id` → ward.ward_id；`hosp_doctor_id` → doctor.doctor_id  

**nursetask**  

- Attributes: `task_id`, `hosp_id`, `type`, `time`, `status`, `detail`, `medicine_snapshot`, `service_fee`, `created_by`  
- PK: `task_id`  
- FK: `hosp_id` → hospitalization.hosp_id；`created_by` → doctor.doctor_id  

**payment**  
- Attributes: `payment_id`, `type`, `amount`, `status`, `time`,  `patient_id`, `reg_id`, `pres_id`, `exam_id`, `hosp_id`  
- PK: `payment_id`  
- FK: `patient_id` → patient.patient_id；`reg_id` → registration.reg_id；`pres_id` → prescription.pres_id；`exam_id` → examination.exam_id；`hosp_id` → hospitalization.hosp_id

关系之间通过外键保持参照完整性并避免冗余；任何多值属性（如药品列表）通过关联表实现，确保达到 3NF、BCNF。
